(()=>{"use strict";function t(){return document.querySelector(".video-stream")}function e(t,e){const i=document.createElement("div");i.classList.add("tooltip-text"),i.textContent=e,document.body.appendChild(i);const o=t.getBoundingClientRect();i.style.position="absolute",i.style.left=`${o.left+window.scrollX+(t.offsetWidth-i.offsetWidth)/2}px`,i.style.top=`${o.top+window.scrollY+t.offsetHeight+5}px`,i.style.visibility="visible",setTimeout((()=>{i.remove()}),3e3)}const i=class{constructor(t){this.container=t,this.video=null,this.speeds=[],this.init()}init(){this.loadSpeeds(),this.setupVideoObserver()}loadSpeeds(){chrome.storage.sync.get({speedList:"1, 1.25, 1.5, 2"},(t=>{this.speeds=t.speedList.split(",").map((t=>parseFloat(t.trim()))),this.speeds.forEach((t=>this.createButton(t)))}))}createButton(t){const e=document.createElement("button");e.textContent=`${t}x`,e.addEventListener("click",(()=>this.onSpeedButtonClick(t))),this.container.appendChild(e)}onSpeedButtonClick(t){this.video&&(this.video.playbackRate=t,this.savePlaybackRate(t),this.updateButtonColors(t))}savePlaybackRate(t){chrome.storage.sync.set({playbackRate:t})}applySavedPlaybackRate(){chrome.storage.sync.get(["playbackRate"],(t=>{t.playbackRate&&this.video&&(this.video.playbackRate=t.playbackRate,this.updateButtonColors(t.playbackRate))}))}updateButtonColors(t){this.container.querySelectorAll("button").forEach((e=>{parseFloat(e.textContent)===t?e.classList.add("active"):e.classList.remove("active")}))}setupVideoObserver(){this.video=t(),this.video?this.addVideoEventListeners():new MutationObserver(((e,i)=>{this.video=t(),this.video&&(this.addVideoEventListeners(),i.disconnect())})).observe(document.body,{childList:!0,subtree:!0});const e=document.querySelector(".html5-video-player");e&&new MutationObserver((()=>{const e=t();e&&e!==this.video&&(this.video=e,this.addVideoEventListeners())})).observe(e,{childList:!0,subtree:!0})}addVideoEventListeners(){this.video&&(this.video.addEventListener("loadedmetadata",(()=>this.applySavedPlaybackRate())),this.applySavedPlaybackRate())}},o=class{constructor(e){this.button=e,this.video=t(),this.init()}init(){this.button.addEventListener("click",(()=>this.takeScreenshot()))}takeScreenshot(){const t=document.createElement("canvas"),e=t.getContext("2d");t.width=this.video.videoWidth,t.height=this.video.videoHeight,e.drawImage(this.video,0,0,t.width,t.height),t.toBlob((t=>this.copyToClipboard(t)),"image/png")}copyToClipboard(t){const i=new ClipboardItem({"image/png":t});navigator.clipboard.write([i]).then((()=>e(this.button,"スクリーンショットをコピーしました。"))).catch((()=>e(this.button,"コピーに失敗しました。")))}};new MutationObserver(((t,e)=>{const s=document.getElementById("clarify-box");if(s){const t=function(){const t=document.createElement("div");t.id="AllContainer";const e=document.createElement("button");e.id="screenshotButton",e.textContent="📷",t.appendChild(e),new o(e);const s=document.createElement("div");return s.id="speedContainer",t.appendChild(s),new i(s),t}();s.parentNode.insertBefore(t,s.nextSibling),e.disconnect()}})).observe(document.body,{childList:!0,subtree:!0})})();
//# sourceMappingURL=bundle.js.map